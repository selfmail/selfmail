model User {
    id String @id @default(cuid())

    email         String    @unique
    emailVerified DateTime?

    name  String?
    image String?

    accounts Account[]
    sessions Session[]

    createdAt          DateTime            @default(now())
    updatedAt          DateTime            @updatedAt
    activities         Activity[]
    emailVerifications EmailVerification[]
    twoFactorTokens    TwoFactorToken[]
    magicLinks         MagicLink[]
    workspaces         Workspace[]
    smtpCredentials    SmtpCredentials[]
    notifications      Notification[]
    invitations        Invitation[]
    members            Member[]

    @@unique([id, email])
}

model Account {
    id String @id @default(cuid())

    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    provider          AuthProvider
    providerAccountId String

    accessToken  String?
    refreshToken String?
    expiresAt    Int?
    tokenType    String?
    scope        String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([provider, providerAccountId])
}

model Session {
    id     String @id @default(cuid())
    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    sessionToken String   @unique
    expires      DateTime

    createdAt DateTime @default(now())
}

enum AuthProvider {
    GITHUB
    GOOGLE
    EMAIL
}

model EmailVerification {
    id String @id @default(uuid())

    // the user that is being verified
    userId String
    user   User   @relation(fields: [userId, email], references: [id, email])

    email String

    // the verification token
    token String @unique

    // the date when the verification was created
    expiresAt DateTime

    @@unique([email, userId])
}

// Two-Factor Authentication
model TwoFactorToken {
    id        String   @id @default(uuid())
    token     String   @unique
    userId    String
    user      User     @relation(fields: [userId], references: [id])
    createdAt DateTime @default(now())
    expiresAt DateTime

    @@index([userId])
    @@index([token])
}

// Magic Link Authentication
model MagicLink {
    id        String   @id @default(uuid())
    email     String
    token     String   @unique
    userId    String?
    user      User?    @relation(fields: [userId], references: [id])
    createdAt DateTime @default(now())
    expiresAt DateTime

    @@index([email])
    @@index([token])
}
